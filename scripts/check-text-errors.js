#!/usr/bin/env node

const fs = require('fs');
const path = require('path');
const glob = require('glob');

// ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ pattern ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
const PATTERNS = {
  // ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏ã‡πâ‡∏≥
  duplicateSymbols: [
    { pattern: /‡∏ø{2,}/g, desc: '‡∏ö‡∏≤‡∏ó‡∏ã‡πâ‡∏≥ (‡∏ø‡∏ø)' },
    { pattern: /\${2,}/g, desc: '‡∏î‡∏≠‡∏•‡∏•‡∏≤‡∏£‡πå‡∏ã‡πâ‡∏≥ ($$)' },
    { pattern: /%{2,}/g, desc: '‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏ã‡πâ‡∏≥ (%%)' },
    { pattern: /#{2,}/g, desc: '‡πÑ‡∏î‡πÄ‡∏≠‡∏ä‡∏ã‡πâ‡∏≥ (##)' },
    { pattern: /\*{3,}/g, desc: '‡∏î‡∏≤‡∏ß‡∏ã‡πâ‡∏≥ (***)' },
    { pattern: /!{2,}/g, desc: '‡∏≠‡∏±‡∏®‡πÄ‡∏à‡∏£‡∏£‡∏¢‡πå‡∏ã‡πâ‡∏≥ (!!)' },
    { pattern: /\?{2,}/g, desc: '‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ã‡πâ‡∏≥ (??)' }
  ],
  
  // ‡∏Ñ‡∏≥‡∏ã‡πâ‡∏≥‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
  duplicateWords: [
    { pattern: /\b(‡∏ß‡πà‡∏≤|‡∏ó‡∏≥|‡πÑ‡∏î‡πâ|‡∏°‡∏µ|‡∏à‡∏∞|‡πÑ‡∏õ|‡∏°‡∏≤|‡πÉ‡∏´‡πâ|‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö|‡∏ï‡πâ‡∏≠‡∏á|‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ|‡∏Ñ‡∏ß‡∏£|‡πÄ‡∏û‡∏∑‡πà‡∏≠|‡∏ã‡∏∂‡πà‡∏á|‡πÅ‡∏•‡πâ‡∏ß|‡∏≠‡∏¢‡πà‡∏≤‡∏á|‡∏≠‡∏µ‡∏Å|‡∏ï‡πà‡∏≤‡∏á|‡∏ó‡∏±‡πâ‡∏á|‡πÄ‡∏≠‡∏á|‡∏•‡∏á|‡πÄ‡∏Ç‡πâ‡∏≤|‡∏≠‡∏≠‡∏Å|‡∏Ç‡∏∂‡πâ‡∏ô|‡∏•‡∏á‡∏°‡∏≤|‡πÑ‡∏õ‡∏´‡∏≤|‡∏°‡∏≤‡∏´‡∏≤|‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô|‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£|‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥|‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£)\s+\1\b/g, desc: '‡∏Ñ‡∏≥‡∏ã‡πâ‡∏≥' }
  ],
  
  // spacing ‡∏ú‡∏¥‡∏î
  spacingErrors: [
    { pattern: /\s{3,}/g, desc: '‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ' },
    { pattern: /\w+\s+(?=,|\.)|(?<=,|\.)\s+\w+/g, desc: '‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏ú‡∏¥‡∏î‡∏´‡∏•‡∏±‡∏á‡∏à‡∏∏‡∏î/‡∏Ñ‡∏≠‡∏°‡∏°‡∏≤' },
    { pattern: /\s+$/gm, desc: '‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î' },
    { pattern: /^\s*\n\s*\n\s*\n/gm, desc: '‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ß‡πà‡∏≤‡∏á‡∏ã‡πâ‡∏≥‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô' }
  ],
  
  // ‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
  commonTypos: [
    { pattern: /‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠/g, desc: '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠ (‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠)' },
    { pattern: /‡πÑ‡∏î‡πâ‡∏ó‡∏≥/g, desc: '‡πÑ‡∏î‡πâ‡∏ó‡∏≥ (‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô ‡πÑ‡∏î‡πâ‡∏ó‡∏≥)' },
    { pattern: /‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ/g, desc: '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)' },
    { pattern: /‡∏à‡∏∞‡∏ó‡∏≥‡πÑ‡∏î‡πâ/g, desc: '‡∏à‡∏∞‡∏ó‡∏≥‡πÑ‡∏î‡πâ (‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô ‡∏à‡∏∞‡∏ó‡∏≥‡πÑ‡∏î‡πâ)' },
    { pattern: /‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ/g, desc: '‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ (‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ)' },
    { pattern: /‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô/g, desc: '‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô (‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô)' },
    { pattern: /‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏Å‡πá‡∏ï‡∏≤‡∏°/g, desc: '‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏Å‡πá‡∏ï‡∏≤‡∏° (‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏Å‡πá‡∏ï‡∏≤‡∏°)' },
    { pattern: /‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£/g, desc: '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)' },
    { pattern: /‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏à‡∏∞/g, desc: '‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏à‡∏∞ (‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏à‡∏∞)' }
  ],
  
  // ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©-‡πÑ‡∏ó‡∏¢
  mixedLang: [
    { pattern: /[A-Za-z]+\s+[‡∏Å-‡πô]+|[‡∏Å-‡πô]+\s+[A-Za-z]+/g, desc: '‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©-‡πÑ‡∏ó‡∏¢‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô' },
    { pattern: /\d+\s+[‡∏Å-‡πô]+|[‡∏Å-‡πô]+\s+\d+/g, desc: '‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç-‡πÑ‡∏ó‡∏¢‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô' }
  ]
};

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå
function findFiles() {
  const patterns = [
    'app/**/*.{tsx,ts,jsx,js}',
    'components/**/*.{tsx,ts,jsx,js}',
    'pages/**/*.{tsx,ts,jsx,js}',
    'lib/**/*.{tsx,ts,jsx,js}',
    'hooks/**/*.{tsx,ts,jsx,js}',
    'utils/**/*.{tsx,ts,jsx,js}'
  ];
  
  const files = [];
  patterns.forEach(pattern => {
    const found = glob.sync(pattern, { cwd: process.cwd() });
    files.push(...found);
  });
  
  return [...new Set(files)]; // ‡∏•‡∏ö‡∏ã‡πâ‡∏≥
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå
function checkFile(filePath) {
  const content = fs.readFileSync(filePath, 'utf8');
  const errors = [];
  
  Object.entries(PATTERNS).forEach(([category, patterns]) => {
    patterns.forEach(({ pattern, desc }) => {
      const matches = content.match(pattern);
      if (matches) {
        errors.push({
          category,
          desc,
          matches: matches.slice(0, 5), // ‡∏à‡∏≥‡∏Å‡∏±‡∏î 5 ‡∏≠‡∏±‡∏ô‡πÅ‡∏£‡∏Å
          count: matches.length
        });
      }
    });
  });
  
  return errors;
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å
function main() {
  console.log('üîç ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î/‡∏ã‡πâ‡∏≥...\n');
  
  const files = findFiles();
  console.log(`üìÅ ‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${files.length} ‡πÑ‡∏ü‡∏•‡πå\n`);
  
  let totalErrors = 0;
  const errorFiles = [];
  
  files.forEach(file => {
    const errors = checkFile(file);
    if (errors.length > 0) {
      totalErrors += errors.reduce((sum, e) => sum + e.count, 0);
      errorFiles.push({ file, errors });
    }
  });
  
  // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
  if (errorFiles.length === 0) {
    console.log('‚úÖ ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!');
  } else {
    console.log(`‚ùå ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalErrors} ‡∏à‡∏∏‡∏î\n`);
    
    errorFiles.forEach(({ file, errors }) => {
      console.log(`üìÑ ${file}`);
      errors.forEach(error => {
        console.log(`   ‚ö†Ô∏è  ${error.desc}: ${error.count} ‡∏à‡∏∏‡∏î`);
        error.matches.forEach((match, i) => {
          if (i < 3) console.log(`      - "${match}"`);
        });
        if (error.matches.length > 3) {
          console.log(`      ... ‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡∏Å ${error.matches.length - 3} ‡∏à‡∏∏‡∏î`);
        }
      });
      console.log('');
    });
    
    // ‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
    console.log('üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:');
    const summary = {};
    errorFiles.forEach(({ errors }) => {
      errors.forEach(error => {
        summary[error.desc] = (summary[error.desc] || 0) + error.count;
      });
    });
    
    Object.entries(summary)
      .sort((a, b) => b[1] - a[1])
      .forEach(([desc, count]) => {
        console.log(`   - ${desc}: ${count} ‡∏à‡∏∏‡∏î`);
      });
  }
  
  console.log('\nüí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:');
  console.log('1. ‡πÉ‡∏ä‡πâ VS Code Search (Ctrl+Shift+F) ‡∏´‡∏≤‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î');
  console.log('2. ‡πÉ‡∏ä‡πâ Find and Replace (Ctrl+H) ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡∏•‡∏∞‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå');
  console.log('3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß');
}

// Run
main();
